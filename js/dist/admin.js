(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var s in o)t.o(o,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:o[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["admin/app"];var o=t.n(e);const s=flarum.core.compat["extensions/afrux-forum-widgets-core/common/extend/Widgets"];var r=t.n(s);function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}const i=flarum.core.compat["common/app"];var u=t.n(i);const c=flarum.core.compat["common/components/LoadingIndicator"];var p=t.n(c);const l=flarum.core.compat["common/helpers/avatar"];var d=t.n(l);const f=flarum.core.compat["common/helpers/icon"];var h=t.n(f);const g=flarum.core.compat["extensions/afrux-forum-widgets-core/common/components/Widget"];var v=t.n(g);const x=flarum.core.compat["common/components/Link"];var y=t.n(x),P=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).monthlyCounts=void 0,e}a(e,t);var o=e.prototype;return o.oninit=function(e){var o,s,r;t.prototype.oninit.call(this,e),this.monthlyCounts=u().forum.attribute("afrux-top-posters-widget.topPosterCounts"),this.loadWithInitialResponse=u().forum.attribute("afrux-forum-widgets-core.preferDataWithInitialLoad"),null!=(o=this.attrs.state).users||(o.users=[]),null!=(s=this.attrs.state).isLoading||(s.isLoading=!0),null!=(r=this.attrs.state).hasLoaded||(r.hasLoaded=!1)},o.oncreate=function(e){t.prototype.oncreate.call(this,e),this.attrs.state.hasLoaded||setTimeout(this.load.bind(this),this.loadWithInitialResponse?0:800)},o.className=function(){return"Afrux-TopPostersWidget"},o.icon=function(){return"fas fa-sort-numeric-down"},o.title=function(){return u().translator.trans("afrux-top-posters-widget.forum.widget.title")},o.description=function(){return""},o.content=function(){var t=this;if(this.attrs.state.isLoading)return m(p(),null);var e=this.attrs.state.users.sort((function(e,o){return t.monthlyCounts[o.id()]-t.monthlyCounts[e.id()]}));return m("div",{className:"Afrux-TopPostersWidget-users"},e.map((function(e){return m(y(),{href:u().route("user",{username:e.slug()}),className:"Afrux-TopPostersWidget-users-item"},m("div",{className:"Afrux-TopPostersWidget-users-item-avatar"},d()(e)),m("div",{className:"Afrux-TopPostersWidget-users-item-content"},m("div",{className:"Afrux-TopPostersWidget-users-item-name"},e.displayName()),m("div",{className:"Afrux-TopPostersWidget-users-item-value"},h()("fas fa-comment-dots")," ",t.monthlyCounts[e.id()])))})))},o.load=function(){var t=this;this.loadWithInitialResponse?this.setResults(u().forum.topPosters()):(this.attrs.state.isLoading=!0,u().store.find("users",{filter:{top_poster:!0}}).then((function(e){t.setResults(e)})))},o.setResults=function(t){this.attrs.state.users=t,this.attrs.state.isLoading=!1,this.attrs.state.hasLoaded=!0,m.redraw()},e}(v());const b=flarum.core.compat["admin/components/ExtensionPage"];var w=t.n(b);const W=flarum.core.compat["common/models/Group"];var L=t.n(W),N=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),this.selected=this.setting("afrux-top-posters-widget.excludeGroups","[]")},s.content=function(){var t=this,e=JSON.parse(this.selected());return[m("div",{className:"container"},m("div",{className:"TopPostersSettingsPage"},m("div",{className:"Form-group"},m("h4",null,o().translator.trans("afrux-top-posters-widget.admin.settings.info")),o().store.all("groups").filter((function(t){return t.id()!==L().GUEST_ID})).map((function(o){return m("div",null,m("label",null,m("input",{type:"checkbox",checked:e.includes(o.id()),onchange:function(s){if(s.target.checked)e.push(o.id());else{var r=e.indexOf(o.id());-1!==r&&e.splice(r,1)}t.selected(JSON.stringify(e))}}),h()(o.icon()||"fas fa-user"),o.namePlural()))}))),this.submitButton()))]},e}(w());o().initializers.add("afrux/top-posters-widget",(function(){var t;o().extensionData.for("afrux-top-posters-widget").registerPage(N),t=o(),(new(r())).add({key:"topPosters",component:P,isDisabled:function(){var e=t.forum.attribute("afrux-forum-widgets-core.preferDataWithInitialLoad"),o=t.forum.attribute("afrux-top-posters-widget.topPosterCounts");return!e&&!t.forum.attribute("canSearchUsers")||!o||!Object.keys(o).length},isUnique:!0,placement:"end",position:3}).extend(t,"afrux-top-posters-widget")}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map