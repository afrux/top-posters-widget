(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["admin/app"];var o=t.n(e);const r=flarum.core.compat["extensions/afrux-forum-widgets-core/common/extend/Widgets"];var s=t.n(r);function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}const a=flarum.core.compat["common/app"];var i=t.n(a);const u=flarum.core.compat["common/components/LoadingIndicator"];var c=t.n(u);const l=flarum.core.compat["common/helpers/avatar"];var p=t.n(l);const d=flarum.core.compat["common/helpers/icon"];var f=t.n(d);const h=flarum.core.compat["extensions/afrux-forum-widgets-core/common/components/Widget"];var g=t.n(h);const v=flarum.core.compat["common/components/Link"];var x=t.n(v);const y=flarum.core.compat["common/utils/extractText"];var b=t.n(y),w=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this).monthlyCounts=void 0,e.loadWithInitialResponse=void 0,e}var o,r;r=t,(o=e).prototype=Object.create(r.prototype),o.prototype.constructor=o,n(o,r);var s=e.prototype;return s.oninit=function(e){var o,r,s;t.prototype.oninit.call(this,e),this.monthlyCounts=i().forum.attribute("afrux-top-posters-widget.topPosterCounts"),this.loadWithInitialResponse=i().forum.attribute("afrux-forum-widgets-core.preferDataWithInitialLoad"),null!=(o=this.attrs.state).users||(o.users=[]),null!=(r=this.attrs.state).isLoading||(r.isLoading=!0),null!=(s=this.attrs.state).hasLoaded||(s.hasLoaded=!1)},s.oncreate=function(e){t.prototype.oncreate.call(this,e),this.attrs.state.hasLoaded||setTimeout(this.load.bind(this),this.loadWithInitialResponse?0:800)},s.className=function(){return"Afrux-TopPostersWidget"},s.icon=function(){return"fas fa-sort-numeric-down"},s.title=function(){return b()(i().translator.trans("afrux-top-posters-widget.forum.widget.title"))},s.description=function(){return""},s.content=function(){var t=this;if(this.attrs.state.isLoading)return m(c(),null);var e=this.attrs.state.users.sort((function(e,o){return t.monthlyCounts[o.id()]-t.monthlyCounts[e.id()]}));return m("div",{className:"Afrux-TopPostersWidget-users"},e.map((function(e){return m(x(),{href:i().route("user",{username:e.slug()}),className:"Afrux-TopPostersWidget-users-item"},m("div",{className:"Afrux-TopPostersWidget-users-item-avatar"},p()(e)),m("div",{className:"Afrux-TopPostersWidget-users-item-content"},m("div",{className:"Afrux-TopPostersWidget-users-item-name"},e.displayName()),m("div",{className:"Afrux-TopPostersWidget-users-item-value"},f()("fas fa-comment-dots")," ",t.monthlyCounts[e.id()])))})))},s.load=function(){var t=this;this.loadWithInitialResponse?this.setResults(i().forum.topPosters()):(this.attrs.state.isLoading=!0,i().store.find("users",{filter:{top_poster:!0}}).then((function(e){t.setResults(e)})))},s.setResults=function(t){this.attrs.state.users=t,this.attrs.state.isLoading=!1,this.attrs.state.hasLoaded=!0,m.redraw()},e}(g());const P=flarum.core.compat["common/models/Group"];var W=t.n(P);const L=flarum.core.compat["common/components/Badge"];var N=t.n(L);o().initializers.add("afrux/top-posters-widget",(function(){var t;t=o(),(new(s())).add({key:"topPosters",component:w,isDisabled:function(){var e=t.forum.attribute("afrux-forum-widgets-core.preferDataWithInitialLoad"),o=t.forum.attribute("afrux-top-posters-widget.topPosterCounts");return!e&&!t.forum.attribute("canSearchUsers")||!o||!Object.keys(o).length},isUnique:!0,placement:"end",position:3}).extend(t,"afrux-top-posters-widget"),o().extensionData.for("afrux-top-posters-widget").registerSetting((function(){var t=this.setting("afrux-top-posters-widget.excludeGroups","[]"),e=JSON.parse(t());return m("div",{className:"Form-group EditUserModal-groups"},m("label",null,o().translator.trans("afrux-top-posters-widget.admin.settings.info")),o().store.all("groups").filter((function(t){return t.id()!==W().GUEST_ID})).map((function(o){return m("div",null,m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:e.includes(o.id()),onchange:function(r){r.target.checked?e.push(o.id()):e=e.filter((function(t){return t!==o.id()})),t(JSON.stringify(e))}}),m(N(),{icon:o.icon()||"fas fa-user",color:o.color()})," ",o.namePlural()))})))}))}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map